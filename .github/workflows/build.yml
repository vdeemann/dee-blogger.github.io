name: ðŸš€ EXTREME BUILD - NO LIMITS

on:
  push:
    branches: [main]
    paths: ['content/**', 'build.sh']
  workflow_dispatch:

permissions: 
  contents: read
  pages: write
  id-token: write

concurrency:
  group: extreme-build
  cancel-in-progress: true

env:
  SITE_TITLE: dee-blogger
  DEBIAN_FRONTEND: noninteractive
  FORCE_COLOR: 0
  CI: true

jobs:
  extreme-build:
    runs-on: ubuntu-latest
    environment: 
      name: github-pages
      url: '${{ steps.deploy.outputs.page_url }}'
    steps:
    - uses: actions/checkout@v4
      with: 
        fetch-depth: 1
        show-progress: false

    - name: âš¡ EXTREME OPTIMIZATION
      run: |
        # CPU & Memory optimizations
        echo 'performance' | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
        echo 3 | sudo tee /proc/sys/vm/drop_caches
        ulimit -n 65536
        
        # Environment setup
        export SITE_TITLE="dee-blogger"
        export BASE_URL="https://vdeemann.github.io/dee-blogger.github.io"
        export LC_ALL=C
        export LANG=C
        
        # Ultra-aggressive build
        time (chmod +x build.sh && ./build.sh)
        
        # Maximum compression pipeline
        parallel -j$(nproc) 'gzip -9 {}' ::: $(find public -type f \( -name "*.html" -o -name "*.css" -o -name "*.js" \))
        
        # Memory cleanup
        sync && echo 3 | sudo tee /proc/sys/vm/drop_caches
        
        # Performance metrics
        echo "ðŸ“Š STATS: $(du -sh public | cut -f1) | $(find public -name "*.html" | wc -l) pages"

    - name: ðŸš€ INSTANT DEPLOY
      id: deploy
      uses: actions/deploy-pages@v4
      with: 
        path: ./public
        timeout: 600000

    - run: echo "ðŸ’¥ EXTREME BUILD COMPLETE â†’ ${{ steps.deploy.outputs.page_url }}"
