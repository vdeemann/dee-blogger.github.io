name: ğŸ”§ DEBUG - Simple Blog Build

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  debug-build:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Debug - Check repository structure
        run: |
          echo "ğŸ“ Repository structure:"
          ls -la
          echo
          echo "ğŸ“ Content directory:"
          if [ -d "content" ]; then
            find content -name "*.md" | head -10
            echo "Total markdown files: $(find content -name "*.md" | wc -l)"
          else
            echo "âŒ No content directory found!"
            echo "Creating sample content..."
            mkdir -p content
            cat > content/2023-01-01-welcome-1.md << 'EOF'
          # Welcome to My Blog
          
          This is a test post to verify the build system works.
          
          Content goes here!
          EOF
          fi
          
      - name: Debug - Check build script
        run: |
          echo "ğŸ”§ Build script status:"
          if [ -f "build.sh" ]; then
            echo "âœ… build.sh exists"
            echo "File permissions: $(ls -la build.sh)"
            echo "First 10 lines:"
            head -10 build.sh
          else
            echo "âŒ build.sh missing!"
            echo "Creating minimal build script..."
            cat > build.sh << 'EOF'
          #!/bin/bash
          set -e
          echo "ğŸš€ Building simple blog..."
          rm -rf public
          mkdir -p public
          echo "<!DOCTYPE html><html><head><title>Debug Blog</title></head><body><h1>Blog is working!</h1><p>Found $(find content -name "*.md" | wc -l) posts</p></body></html>" > public/index.html
          echo "âœ… Build complete"
          EOF
            chmod +x build.sh
          fi
          
      - name: Run build
        run: |
          chmod +x build.sh
          ./build.sh
          
      - name: Debug - Check build output
        run: |
          echo "ğŸ“Š Build output:"
          if [ -d "public" ]; then
            echo "âœ… public directory exists"
            find public -type f | head -10
            echo "Total files: $(find public -type f | wc -l)"
            echo
            echo "ğŸ“„ Index file content:"
            if [ -f "public/index.html" ]; then
              cat public/index.html
            else
              echo "âŒ No index.html found"
            fi
          else
            echo "âŒ No public directory created"
            exit 1
          fi
          
      - name: Setup Pages
        uses: actions/configure-pages@v4
        
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public
          
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        
      - name: Success notification
        run: |
          echo "ğŸ‰ Build and deployment completed!"
          echo "ğŸŒ Your site should be available at: ${{ steps.deployment.outputs.page_url }}"
          echo "ğŸ“Š Final stats:"
          echo "  - Total files deployed: $(find public -type f | wc -l)"
          echo "  - Site size: $(du -sh public | cut -f1)"
